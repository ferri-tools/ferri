# Ferri Layer 3 (L3) Manual Test Plan: Unified and Interactive Flow Monitoring

## 1. Introduction

This document provides a step-by-step manual testing plan for the unified and interactive flow monitoring system, a Layer 3 (L3) feature. The goal is to verify that both the agentic `ferri do` command and the manual `ferri flow run` command provide an identical, real-time, and interactive TUI monitoring experience.

This test will confirm that the log-based architecture successfully provides a consistent user experience and that the TUI can display live terminal output for selected jobs.

## 2. Prerequisites

Before starting, ensure you have the following:
- `ferri` compiled and available in your system's `PATH`.
- A Google AI API key for testing the `ferri do` agent.
- A clean directory for a new test project.

## 3. Test Execution

### Part 1: Project Setup

This part verifies that a new Ferri project can be created and configured for agentic commands.

1.  **Create a test directory and navigate into it:**
    ```bash
    mkdir ferri-l3-interactive-test
    cd ferri-l3-interactive-test
    ```

2.  **Initialize the project:**
    ```bash
    ferri init
    ```
    - **Expected Result:** The command should initialize a `.ferri` directory successfully.

3.  **Set the Gemini API Key:**
    *Replace `YOUR_GEMINI_API_KEY` with your actual key.*
    ```bash
    ferri secrets set GEMINI_API_KEY "YOUR_GEMINI_API_KEY"
    ```
    - **Expected Result:** The command should succeed without error.

### Part 2: `ferri do` Interactive TUI Test

This part tests the interactive monitoring experience for a dynamically generated flow.

1.  **Execute a multi-step agentic command that produces output:**
    ```bash
    ferri do "create a rust project named 'my-app' and then compile it"
    ```
    - **Expected Result (Initial View):**
        1. The agent will first print that it is generating a flow.
        2. A full-screen, two-pane TUI will appear.
        3. The **left pane** lists the jobs (e.g., `create-project`, `build-project`), with the first job highlighted.
        4. The **right pane** shows the live terminal output for the highlighted `create-project` job (e.g., `Created binary (application) 'my-app' package`).

2.  **Interact with the TUI:**
    - **Action:** While the flow is running, press the **down arrow key (↓)**.
    - **Expected Result:**
        1. The highlight in the left pane moves to the `build-project` job.
        2. The right pane's content **changes** to show the live output of the `cargo build` command (e.g., `Compiling my-app v0.1.0...`).
    - **Action:** Press the **up arrow key (↑)**.
    - **Expected Result:**
        1. The highlight in the left pane moves back to the `create-project` job.
        2. The right pane's content switches back to show the output of the `cargo new` command.

3.  **Verify Completion:**
    - **Expected Result:** The TUI will exit automatically once the final job is complete. A new directory named `my-app` will exist.

### Part 3: `ferri flow run` Interactive TUI Test

This part verifies that the interactive experience is identical when running a pre-existing flow file.

1.  **Identify the Generated Flow File:**
    - **Action:** List the contents of the `.ferri/do/` directory to find the YAML file generated by the previous command (e.g., `flow-16...yml`).

2.  **Execute the flow file manually:**
    *Replace `<path-to-your-flow-file.yml>` with the actual filename.*
    ```bash
    ferri flow run .ferri/do/<path-to-your-flow-file.yml>
    ```
    - **Expected Result:** The **exact same interactive TUI** from Part 2 will appear. All the interaction steps from Part 2, step 2 should be repeatable and yield the same results.

### Part 4: Log File Inspection

This part verifies that the logs, including the new output lines, are being written correctly.

1.  **Inspect a log file:**
    *Choose one of the log files created in the `.ferri/runs/` directory.*
    ```bash
    cat .ferri/runs/<your-log-file-name.log>
    ```
    - **Expected Result:** The file should contain a series of single-line JSON objects. You should see both job status updates (e.g., `{"job":{"jobId":"create-project","status":"Succeeded"}}`) and terminal output lines (e.g., `{"output":{"jobId":"create-project","line":"       Created binary (application) `my-app` package"}}`).

## 4. Conclusion

If all the above steps completed with the expected results, the L3 interactive flow monitoring system is verified. This plan confirms that `ferri do` and `ferri flow run` provide a consistent, reliable, and deeply observable user experience, allowing users to inspect live terminal output for any job in the flow.
# QA Walkthrough: Long-Running Gemini Jobs

**Objective:** This document provides a step-by-step guide to test the creation of a long-running, remote AI job using Google's Gemini and to verify its successful execution.

**Goal:** Successfully start a background Gemini job, monitor its status, and retrieve the complete output.

---

### Step 1: Prerequisites

1.  Ensure your project has been initialized. If not, run `ferri init`.
2.  You must have a Google API key. You can get one from [Google AI Studio](https://aistudio.google.com/app/apikey).

---

### Step 2: Configure the Secret

Your API key must be stored as a secure secret. This command will save your key under the name `GOOGLE_API_KEY`.

**Command:**
```bash
# Replace "YOUR_API_KEY_HERE" with your actual key
ferri secrets set GOOGLE_API_KEY "YOUR_API_KEY_HERE"
```

*Example using the key you provided (partially redacted for security):*
```bash
ferri secrets set GOOGLE_API_KEY "AIzaSyBFTGCFRI7c6SkaIXMFLPkgRcA3BjK...-0"
```

---

### Step 3: Add the Gemini Model

Next, register the `gemini-pro` model with Ferri. This command tells Ferri that `gemini-pro` is a Google model and that it needs to use the `GOOGLE_API_KEY` secret to authenticate.

**Command:**
```bash
ferri models add gemini-pro --provider google --model-name gemini-pro --api-key-secret GOOGLE_API_KEY
```

**Expected Result:**
```
Model 'gemini-pro' added successfully.
```

---

### Step 4: Start the Long-Running Job

Now, you can start a background job. We will ask the model to perform a creative task that takes a few moments to complete.

**Command:**
```bash
ferri run --model gemini-pro -- "Generate a detailed 7-day itinerary for a fantasy adventure through a magical forest, including encounters with mythical creatures and hidden landmarks."
```

**Expected Result:**
You will see a confirmation that the job was submitted, along with its unique ID.
```
Successfully submitted job 'job-xxxxxx'.
Process ID: 12345
```
*(Note: The job ID and process ID will be different on your machine.)*

---

### Step 5: Monitor the Job in the Dashboard

View the `ps` dashboard to see your job's status.

**Command:**
```bash
ferri ps
```

**Expected Result:**
1.  The dashboard will appear.
2.  You will see your new job listed (e.g., `job-xxxxxx`).
3.  The status will show as **Running** while the Gemini API processes the request.
4.  After a short time, the status will change to **Completed**.
5.  If the status becomes **Failed**, you can select the job (using the arrow keys) to see a preview of the error in the details panel on the right. This usually indicates an issue with the API key.

---

### Step 6: Retrieve the Final Output

Once the job is marked as **Completed**, use the `yank` command to get the full itinerary.

**Command:**
```bash
# Replace 'job-xxxxxx' with the actual ID of your job
ferri yank job-xxxxxx
```

**Expected Result:**
The terminal will print the complete, detailed 7-day fantasy itinerary generated by the Gemini model. This confirms the entire workflow is functioning correctly.
